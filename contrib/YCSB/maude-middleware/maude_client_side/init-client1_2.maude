load ramp-f

mod INIT-CLIENT is
  inc RAMP-F .
  inc SHIM-DYNAMIC .


  vars O O' : Oid .
  vars N' N : Nat .
  vars STR KR : String .
  var RT : ReplicaTable .

  ---(
  *** post load
 crl < O : Table | table : RT >
     [KR,O']
   => 
     < O : Table | table : addKeyReplica(KR,RT) >
     if N := find(KR,"[eoa]",0) .

  op addKeyReplica : String ReplicaTable -> ReplicaTable .
 ceq addKeyReplica(KR,RT) = addKeyReplica(substr(STR,N' + 5,length(STR)),insert(substr(KR,0,N),substr(STR,0,N'),RT))
       if N := find(KR, "[eok]", 0) /\ 
        STR := substr(KR, N + 5, length(KR)) /\
         N' := find(STR, "[eoa]", 0) .
  eq addKeyReplica("",RT) = RT .
  )

  ops tb m : -> Oid .

  op self : -> String .
  eq port = 9000 .  *** the base port for client talking to server
  eq backLog = 1 .  *** the BACKLOG parameter on the server side
  op clientId : -> Nat .

  *** Newly added for separating YCSB
  op initTable : -> ReplicaTable .
  op initSqn : -> Nat .
  op initTxns : -> ObjList .


  ***START AUTOMATICALLY GENERATED PARAMETER CODE***
  eq self = "155.98.36.65" .
  eq numberOfServerSockets = 0 . *** one for post-load, one for txns
  eq clientId = 2 .

  eq initTable = ( "user49652" |-> "155.98.36.63", "user49773" |-> "155.98.36.63", "user50642" |-> "155.98.36.63", "user48687" |-> "155.98.36.63", "user48720" |-> "155.98.36.63", "user49777" |-> "155.98.36.63", "user48842" |-> "155.98.36.63", "user49655" |-> "155.98.36.63", "user1792" |-> "155.98.36.63", "user49774" |-> "155.98.36.63", "user48846" |-> "155.98.36.63", "user49657" |-> "155.98.36.63", "user49811" |-> "155.98.36.63", "user48726" |-> "155.98.36.63", "user48848" |-> "155.98.36.63", "user50769" |-> "155.98.36.63", "user50804" |-> "155.98.36.63", "user49780" |-> "155.98.36.63", "user50766" |-> "155.98.36.63", "user48691" |-> "155.98.36.63", "user50646" |-> "155.98.36.63", "user50773" |-> "155.98.36.63", "user48695" |-> "155.98.36.63", "user48851" |-> "155.98.36.63", "user1605" |-> "155.98.36.63", "user1727" |-> "155.98.36.63", "user1696" |-> "155.98.36.63", "user1574" |-> "155.98.36.63", "user48662" |-> "155.98.36.63", "user49750" |-> "155.98.36.63", "user1731" |-> "155.98.36.63", "user48780" |-> "155.98.36.63", "user50742" |-> "155.98.36.63", "user49594" |-> "155.98.36.63", "user1692" |-> "155.98.36.63", "user1570" |-> "155.98.36.63", "user48784" |-> "155.98.36.63", "user49873" |-> "155.98.36.63", "user50583" |-> "155.98.36.63", "user48788" |-> "155.98.36.63", "user49649" |-> "155.98.36.63", "user49806" |-> "155.98.36.63", "user1630" |-> "155.98.36.63", "user48882" |-> "155.98.36.63", "user53" |-> "155.98.36.63", "user48880" |-> "155.98.36.63", "user57" |-> "155.98.36.63", "user51" |-> "155.98.36.63", "user49619" |-> "155.98.36.63", "user50609" |-> "155.98.36.63", "user1638" |-> "155.98.36.63", "user1759" |-> "155.98.36.63", "user1634" |-> "155.98.36.63", "user49589" |-> "155.98.36.63", "user49622" |-> "155.98.36.63", "user48658" |-> "155.98.36.63", "user49748" |-> "155.98.36.63", "user48813" |-> "155.98.36.63", "user49746" |-> "155.98.36.63", "user49867" |-> "155.98.36.63", "user49624" |-> "155.98.36.63", "user49745" |-> "155.98.36.63", "user48817" |-> "155.98.36.63", "user50737" |-> "155.98.36.63", "user50615" |-> "155.98.36.63", "user49592" |-> "155.98.36.63", "user50578" |-> "155.98.36.63", "user50734" |-> "155.98.36.63", "user48625" |-> "155.98.36.63", "user48629" |-> "155.98.36.63", "user49838" |-> "155.98.36.63", "user48909" |-> "155.98.36.63", "user48906" |-> "155.98.36.63", "user1817" |-> "155.98.36.63", "user50707" |-> "155.98.36.63", "user50828" |-> "155.98.36.63", "user50704" |-> "155.98.36.63", "user1663" |-> "155.98.36.63", "user1784" |-> "155.98.36.63", "user50830" |-> "155.98.36.63", "user49682" |-> "155.98.36.63", "user50675" |-> "155.98.36.63", "user48632" |-> "155.98.36.63", "user48875" |-> "155.98.36.63", "user49842" |-> "155.98.36.63", "user48751" |-> "155.98.36.63", "user50551" |-> "155.98.36.63", "user50671" |-> "155.98.36.63", "user48878" |-> "155.98.36.63", "user48755" |-> "155.98.36.63", "user48913" |-> "155.98.36.63", "user50835" |-> "155.98.36.63", "user1667" |-> "155.98.36.63", "user1700" |-> "155.98.36.63", "user1788" |-> "155.98.36.63", "user1821" |-> "155.98.36.63", "user50710" |-> "155.98.36.63", "user50798" |-> "155.98.36.63", "user50679" |-> "155.98.36.63", "user50833" |-> "155.98.36.63", "user50641" |-> "155.98.36.123", "user49772" |-> "155.98.36.123", "user50643" |-> "155.98.36.123", "user50764" |-> "155.98.36.123", "user1791" |-> "155.98.36.123", "user49810" |-> "155.98.36.123", "user48688" |-> "155.98.36.123", "user49775" |-> "155.98.36.123", "user48725" |-> "155.98.36.123", "user48722" |-> "155.98.36.123", "user49778" |-> "155.98.36.123", "user50649" |-> "155.98.36.123", "user50803" |-> "155.98.36.123", "user50647" |-> "155.98.36.123", "user50768" |-> "155.98.36.123", "user50801" |-> "155.98.36.123", "user50772" |-> "155.98.36.123", "user48692" |-> "155.98.36.123", "user49781" |-> "155.98.36.123", "user50770" |-> "155.98.36.123", "user1725" |-> "155.98.36.123", "user1606" |-> "155.98.36.123", "user1568" |-> "155.98.36.123", "user1722" |-> "155.98.36.123", "user1600" |-> "155.98.36.123", "user1602" |-> "155.98.36.123", "user50586" |-> "155.98.36.123", "user48783" |-> "155.98.36.123", "user49871" |-> "155.98.36.123", "user1576" |-> "155.98.36.123", "user1697" |-> "155.98.36.123", "user1730" |-> "155.98.36.123", "user48660" |-> "155.98.36.123", "user50741" |-> "155.98.36.123", "user48787" |-> "155.98.36.123", "user48820" |-> "155.98.36.123", "user48663" |-> "155.98.36.123", "user49874" |-> "155.98.36.123", "user50584" |-> "155.98.36.123", "user1572" |-> "155.98.36.123", "user1693" |-> "155.98.36.123", "user50580" |-> "155.98.36.123", "user49807" |-> "155.98.36.123", "user48718" |-> "155.98.36.123", "user49805" |-> "155.98.36.123", "user55" |-> "155.98.36.123", "user1631" |-> "155.98.36.123", "user50680" |-> "155.98.36.123", "user1758" |-> "155.98.36.123", "user1755" |-> "155.98.36.123", "user1635" |-> "155.98.36.123", "user1762" |-> "155.98.36.123", "user49865" |-> "155.98.36.123", "user48812" |-> "155.98.36.123", "user49747" |-> "155.98.36.123", "user49868" |-> "155.98.36.123", "user48656" |-> "155.98.36.123", "user48815" |-> "155.98.36.123", "user49749" |-> "155.98.36.123", "user50616" |-> "155.98.36.123", "user50736" |-> "155.98.36.123", "user50739" |-> "155.98.36.123", "user49" |-> "155.98.36.123", "user50733" |-> "155.98.36.123", "user50611" |-> "155.98.36.123", "user50613" |-> "155.98.36.123", "user49834" |-> "155.98.36.123", "user48628" |-> "155.98.36.123", "user48749" |-> "155.98.36.123", "user49837" |-> "155.98.36.123", "user50708" |-> "155.98.36.123", "user50829" |-> "155.98.36.123", "user50549" |-> "155.98.36.123", "user50703" |-> "155.98.36.123", "user1816" |-> "155.98.36.123", "user50706" |-> "155.98.36.123", "user50826" |-> "155.98.36.123", "user50674" |-> "155.98.36.123", "user50795" |-> "155.98.36.123", "user50676" |-> "155.98.36.123", "user50797" |-> "155.98.36.123", "user1664" |-> "155.98.36.123", "user50554" |-> "155.98.36.123", "user48754" |-> "155.98.36.123", "user1660" |-> "155.98.36.123", "user48631" |-> "155.98.36.123", "user49840" |-> "155.98.36.123", "user50550" |-> "155.98.36.123", "user48758" |-> "155.98.36.123", "user1824" |-> "155.98.36.123", "user50678" |-> "155.98.36.123", "user50711" |-> "155.98.36.123", "user50799" |-> "155.98.36.123", "user50832" |-> "155.98.36.123", "user1787" |-> "155.98.36.123", "user1820" |-> "155.98.36.123", "user50556" |-> "155.98.36.123", "user50831" |-> "155.98.36.123", "user50834" |-> "155.98.36.123", "user1668" |-> "155.98.36.123", "user49650" |-> "155.98.36.123", "user49656" |-> "155.98.36.123", "user49776" |-> "155.98.36.123", "user1793" |-> "155.98.36.123", "user49653" |-> "155.98.36.123", "user48689" |-> "155.98.36.123", "user49779" |-> "155.98.36.123", "user49812" |-> "155.98.36.123", "user48723" |-> "155.98.36.123", "user48844" |-> "155.98.36.123", "user48847" |-> "155.98.36.123", "user48727" |-> "155.98.36.123", "user50648" |-> "155.98.36.123", "user50644" |-> "155.98.36.123", "user48694" |-> "155.98.36.123", "user48850" |-> "155.98.36.123", "user1729" |-> "155.98.36.123", "user1726" |-> "155.98.36.123", "user1607" |-> "155.98.36.123", "user1601" |-> "155.98.36.123", "user1603" |-> "155.98.36.123", "user1724" |-> "155.98.36.123", "user1569" |-> "155.98.36.123", "user49872" |-> "155.98.36.123", "user50585" |-> "155.98.36.123", "user1698" |-> "155.98.36.123", "user48781" |-> "155.98.36.123", "user50587" |-> "155.98.36.123", "user50582" |-> "155.98.36.123", "user1691" |-> "155.98.36.123", "user1573" |-> "155.98.36.123", "user1694" |-> "155.98.36.123", "user48664" |-> "155.98.36.123", "user48785" |-> "155.98.36.123", "user48789" |-> "155.98.36.123", "user49804" |-> "155.98.36.123", "user48719" |-> "155.98.36.123", "user49808" |-> "155.98.36.123", "user1632" |-> "155.98.36.123", "user52" |-> "155.98.36.123", "user1598" |-> "155.98.36.123", "user56" |-> "155.98.36.123", "user49617" |-> "155.98.36.123", "user1754" |-> "155.98.36.123", "user1636" |-> "155.98.36.123", "user1757" |-> "155.98.36.123", "user1761" |-> "155.98.36.123", "user48" |-> "155.98.36.123", "user49623" |-> "155.98.36.123", "user49744" |-> "155.98.36.123", "user49742" |-> "155.98.36.123", "user49587" |-> "155.98.36.123", "user49620" |-> "155.98.36.123", "user49869" |-> "155.98.36.123", "user48659" |-> "155.98.36.123", "user49626" |-> "155.98.36.123", "user49866" |-> "155.98.36.123", "user48816" |-> "155.98.36.123", "user48819" |-> "155.98.36.123", "user50618" |-> "155.98.36.123", "user50617" |-> "155.98.36.123", "user49593" |-> "155.98.36.123", "user50579" |-> "155.98.36.123", "user50612" |-> "155.98.36.123", "user49590" |-> "155.98.36.123", "user49711" |-> "155.98.36.123", "user49715" |-> "155.98.36.123", "user49836" |-> "155.98.36.123", "user48626" |-> "155.98.36.123", "user49714" |-> "155.98.36.123", "user49713" |-> "155.98.36.123", "user49679" |-> "155.98.36.123", "user48904" |-> "155.98.36.123", "user49719" |-> "155.98.36.123", "user49839" |-> "155.98.36.123", "user49717" |-> "155.98.36.123", "user48907" |-> "155.98.36.123", "user1818" |-> "155.98.36.123", "user49681" |-> "155.98.36.123", "user50547" |-> "155.98.36.123", "user49684" |-> "155.98.36.123", "user50552" |-> "155.98.36.123", "user1665" |-> "155.98.36.123", "user50555" |-> "155.98.36.123", "user1785" |-> "155.98.36.123", "user49688" |-> "155.98.36.123", "user1661" |-> "155.98.36.123", "user49841" |-> "155.98.36.123", "user50672" |-> "155.98.36.123", "user48752" |-> "155.98.36.123", "user48873" |-> "155.98.36.123", "user49686" |-> "155.98.36.123", "user48879" |-> "155.98.36.123", "user48912" |-> "155.98.36.123", "user48634" |-> "155.98.36.123", "user48756" |-> "155.98.36.123", "user48877" |-> "155.98.36.123", "user48910" |-> "155.98.36.123", "user1789" |-> "155.98.36.123", "user1822" |-> "155.98.36.123", "user49651" |-> "155.98.36.63", "user50640" |-> "155.98.36.63", "user1790" |-> "155.98.36.63", "user48721" |-> "155.98.36.63", "user49654" |-> "155.98.36.63", "user48724" |-> "155.98.36.63", "user48845" |-> "155.98.36.63", "user48843" |-> "155.98.36.63", "user48849" |-> "155.98.36.63", "user50802" |-> "155.98.36.63", "user48690" |-> "155.98.36.63", "user50645" |-> "155.98.36.63", "user50765" |-> "155.98.36.63", "user50767" |-> "155.98.36.63", "user50800" |-> "155.98.36.63", "user48693" |-> "155.98.36.63", "user48696" |-> "155.98.36.63", "user50771" |-> "155.98.36.63", "user1604" |-> "155.98.36.63", "user1728" |-> "155.98.36.63", "user1567" |-> "155.98.36.63", "user1723" |-> "155.98.36.63", "user1575" |-> "155.98.36.63", "user48661" |-> "155.98.36.63", "user48782" |-> "155.98.36.63", "user50740" |-> "155.98.36.63", "user1695" |-> "155.98.36.63", "user49595" |-> "155.98.36.63", "user49870" |-> "155.98.36.63", "user1571" |-> "155.98.36.63", "user48665" |-> "155.98.36.63", "user48786" |-> "155.98.36.63", "user50581" |-> "155.98.36.63", "user1699" |-> "155.98.36.63", "user49803" |-> "155.98.36.63", "user49648" |-> "155.98.36.63", "user49809" |-> "155.98.36.63", "user1629" |-> "155.98.36.63", "user48881" |-> "155.98.36.63", "user54" |-> "155.98.36.63", "user1599" |-> "155.98.36.63", "user1753" |-> "155.98.36.63", "user50" |-> "155.98.36.63", "user49618" |-> "155.98.36.63", "user1637" |-> "155.98.36.63", "user1633" |-> "155.98.36.63", "user1756" |-> "155.98.36.63", "user49586" |-> "155.98.36.63", "user50610" |-> "155.98.36.63", "user49743" |-> "155.98.36.63", "user1760" |-> "155.98.36.63", "user49588" |-> "155.98.36.63", "user49621" |-> "155.98.36.63", "user49741" |-> "155.98.36.63", "user49625" |-> "155.98.36.63", "user48657" |-> "155.98.36.63", "user48811" |-> "155.98.36.63", "user48814" |-> "155.98.36.63", "user48818" |-> "155.98.36.63", "user50738" |-> "155.98.36.63", "user49591" |-> "155.98.36.63", "user50614" |-> "155.98.36.63", "user50735" |-> "155.98.36.63", "user49710" |-> "155.98.36.63", "user49835" |-> "155.98.36.63", "user49712" |-> "155.98.36.63", "user48905" |-> "155.98.36.63", "user49718" |-> "155.98.36.63", "user48627" |-> "155.98.36.63", "user49716" |-> "155.98.36.63", "user48908" |-> "155.98.36.63", "user1819" |-> "155.98.36.63", "user50709" |-> "155.98.36.63", "user50827" |-> "155.98.36.63", "user1815" |-> "155.98.36.63", "user50705" |-> "155.98.36.63", "user49680" |-> "155.98.36.63", "user50548" |-> "155.98.36.63", "user50702" |-> "155.98.36.63", "user49685" |-> "155.98.36.63", "user50553" |-> "155.98.36.63", "user1662" |-> "155.98.36.63", "user48750" |-> "155.98.36.63", "user50673" |-> "155.98.36.63", "user1786" |-> "155.98.36.63", "user49683" |-> "155.98.36.63", "user50796" |-> "155.98.36.63", "user48753" |-> "155.98.36.63", "user48874" |-> "155.98.36.63", "user49843" |-> "155.98.36.63", "user48633" |-> "155.98.36.63", "user48630" |-> "155.98.36.63", "user49687" |-> "155.98.36.63", "user48757" |-> "155.98.36.63", "user48911" |-> "155.98.36.63", "user48876" |-> "155.98.36.63", "user1666" |-> "155.98.36.63", "user50677" |-> "155.98.36.63", "user1669" |-> "155.98.36.63", "user1823" |-> "155.98.36.63" ) .
  eq initSqn = $p4$ .
  eq initTxns = $p5$ .
  ***END AUTOMATICALLY GENERATED PARAMETER CODE***

  op init : -> Configuration .
  eq init = <>
            < l(self,10000) : ClientShim | sockets : none, contacts : empty, bufferedMsgs : none >
            < l(self,10001) : ServerShim | sockets : none, contacts : empty, bufferedMsgs : none, created : 0 >

            < l(self,clientId) : Client | txns : initTxns, sqn : initSqn,
                                   executing : none, committed : none, 
                                   1stGetSites : no1st, 2ndGetSites : no2nd,
                                   voteSites : noVS, commitSites : noVS > 

            < tb : Table | table : initTable >

            < m : Monitor | count : 0 >

	    ***START AUTOMATICALLY GENERATED SOCKET CODE***
            ***createServerTcpSocket(socketManager, l(self,clientId), 9810, 10)  *** opened for post-load
            ***createServerTcpSocket(socketManager, l(self,clientId), 9910, 10)  *** opened for txns
	    ***END AUTOMATICALLY GENERATED SOCKET CODE***
        .

  --- local test
  ---(
  eq init = ---<>
            ---< l(self,10000) : ClientShim | sockets : none, contacts : empty, bufferedMsgs : none >
            ---< l(self,10001) : ServerShim | sockets : none, contacts : empty, bufferedMsgs : none, created : 0 >

            *** l(self,0) when deployed
            < l(self) : Client | txns : emptyTxnList, sqn : 0,
                                 executing : none, committed : none, 
                                 1stGetSites : no1st, 2ndGetSites : no2nd,
                                 voteSites : noVS, commitSites : noVS > 

            < l(addr1) : Replica | datastore : empty, latestCommit : empty >

            < tb : Table | table : "k0" |-> addr1, "k1" |-> addr1 >

            < m : Monitor | count : 0 >

            ["k0[eok]v0[eov]k1[eok]v1[eov]",l(self)]  
            ["k0[eor]k1[eor]",l(self)] .  *** l(self,0) when deployed
  )
endm

---rew init .
erew init .
